_**Агрегация** — модуль для преобразования данных, позволяющий выполнять одну настройку за одну версию преобразования._  
Чтобы начать работу, откройте страницу версии настройки и выберите **Агрегация** на функциональной панели.

![1_Aggregation_list.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/1_Aggregation_list.png)
**Результат:** отобразится выпадающий список агрегаций.

## Сохранить поля
1. Выберите операцию **Сохранить поля** из списка.
2. В открывшемся окне:
   - Нажмите на переключатель.
   - Выберите поля.

 ![2_Save_field.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/2_Save_field.png)
  - Нажмите **Сохранить**.
**Результат**: указанные поля добавятся в производную версию.

![3_Save_field_result.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/3_Save_field_result.png)
## Удалить поля

1. Выберите операцию **«Удалить поля»** из списка.
2. В открывшемся окне:
   - Нажмите на переключатель.
   - Отметьте поля, которые необходимо удалить.

![4_Del_field.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/4_Del_field.png)
   - Нажмите **«Сохранить»**.

**Результат**: производная версия настройки не содержит указанные поля.

![5_Del_field_result.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/5_Del_field_result.png)
## Сгруппировать дубли

1. Выберите операцию **«Сгруппировать дубли»** из списка.
2. В открывшемся окне:
   - Установите переключатель **«поля для группировки»**.
   - Выберите поля и нажмите **«Сохранить»**.

![Group_doubles.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/6_Group_dubles.png)
**Производная версия содержит:**

- Поле с отображением длины массива **BunchSize**.
- Поле с группами уникальных значений, вложенных в массив данных.
- Исходное поле.

![7_Group_doubles_result.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/7_Group_dubles_result.png)

Для просмотра содержимого массива дважды щелкните по нему.  
**Результат**: отобразится окно со списком полей, вложенных в массив.
![8_Group_doubles_params.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/8_Group_dubles_params.png)
При щелчке на поле отобразятся данные массива.
![9_Group_doubles_massive_data.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/9_Group_dubles_massive_data.png)
> **Ограничение**: размер документа — 16 Мб. Ограничение может быть превышено после группировки. 

Для корректного выполнения установите максимальное количество значений при заполнении параметров.  

![10_Group_doubles_max_size.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/10_Group_dubles_max_size.png)
Чтобы развернуть массив на верхний уровень, используйте агрегацию **Развернуть массив**.

## Удалить дубли
Удаляет дублирующие значения.
1. Выберите операцию **Удалить дубли** из списка.
2. В открывшемся окне:
   - Установите переключатель **поля**.
   - Выберите поля и нажмите **Сохранить**.

![11_Del_doubles.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/11_Del_dubles.png)
**Результат**: будет создана производная версия с уникальными значениями полей.

## Развернуть массив

Разворачивает массив данных на верхний уровень.  
Для выполнения операции используйте коллекцию с вложенным массивом данных (в таблице отображается в виде квадратных и фигурных скобок [количество значений{}]).

1. Выберите операцию **Развернуть массив** из списка.
2. В открывшемся окне:
   - Установите параметр **поле** по заголовку поля, содержащего массив данных.
   - Введите произвольный префикс.

![12_Razvernut_massive.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/12_Razvernut_massive.png)
  - Нажмите **Сохранить**.

**Результат**: подмассивы вынесены на верхний уровень с указанным префиксом.  

![13_Razvernut_massive_result.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/13_Razvernut_massive_result.png)

## Развернуть в объект

1. Выберите операцию **«Развернуть в объект»** из списка.
2. В открывшемся окне:
   - Установите параметр **«поле»** по заголовку (исходное поле должно содержать вложенный массив данных).

![14_to_object_params.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/14_to_object_params.png)
  - Нажмите **«Сохранить»**.

**Результат**: поля массива разворачиваются в объект (объект отображается с фигурными скобками).

![15_Razvernut_to_obj_result.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/15_Razvernut_to_obj_result.png)
> В результате данной функции доступно назначение параметров ко вложенным данным.

### Назначение параметров ко вложенному объекту

Для преобразования данных во вложенном объекте:

1. Выберите операцию преобразования.
2. Откройте вложенную структуру, дважды щелкнув по ячейке.
3. Нажмите на поле, содержащее вложенную структуру (поля со вложенными структурами отображаются контрастно).
4. Дважды щелкните на объект для отображения данных.
5. Выставьте параметры условия, введите имя производного поля и нажмите **«Сохранить»**.

![16_Params_to_vlojennyu_struktura.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/16_Params_to_vlojennyu_struktura.png)
**Результат**: операция будет применена к данным внутри объекта.
## Посчитать минимум

Вычисляет минимальное значение для группы значений.

1. Выберите операцию **Посчитать минимум**.
2. В открывшемся окне:
   - Установите переключатель **поля для группировки**.
   - Выберите поля.

   ![17_min_field_field_for_groups.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/17_min_field_field_for_groups.png)
   - Установите параметр **минимум по полю**.

   ![18_min_for_field.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/18_min_for_field.png)
3. Нажмите **Сохранит»**.

**Результат**: созданы уникальные группы значений с рассчитанным минимумом для каждой.
![19_min_field_result.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/19_min_field_result.png)