_**"Агрегация"** — модуль для преобразования данных, позволяющий выполнять одну настройку за одну версию преобразования._  
Чтобы начать работу, откройте страницу версии настройки и выберите **"Агрегация"** на функциональной панели.

![Список агрегаций.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/1_Aggregation_list.png)
**Результат:** отобразится выпадающий список агрегаций.

## Сохранить поля
1. Выберите операцию **"Сохранить поля"** из списка.
2. В открывшемся окне:
<ul>
  <li>Нажмите на переключатель.</li>
  <li>Выберите поля.</li>
</ul>

 ![2_Save_field.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/2_Save_field.png)

* Нажмите **"Сохранить"**.

**Результат**: указанные поля добавятся в **результарующую версию**.

![3_Save_field_result.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/3_Save_field_result.png)
## Удалить поля

1. Выберите операцию **"Удалить поля"** из списка.
2. В открывшемся окне:
<ul>
   <li>Нажмите переключатель.</li>
   <li>Отметьте поля, которые нужно удалить.</li>
</ul>

![4_Del_field.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/4_Del_field.png)
* Нажмите **«Сохранить»**.

**Результат**: производная версия настройки не содержит указанные поля.

![5_Del_field_result.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/5_Del_field_result.png)
## Сгруппировать дубли

1. Выберите операцию **«Сгруппировать дубли»** из списка.
2. В открывшемся окне:

<ul>
<li>Установите переключатель <b>"поля для группировки"</b>.</li>
<li>Выберите поля и нажмите <b>"Сохранить"</b>.</li>
</ul>

![Group_doubles.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/6_Group_dubles.png)
**Производная версия содержит:**

- Поле с отображением длины массива **"BunchSize"**.
- Поле с группами уникальных значений, вложенных в массив данных.
- Исходное поле.

![7_Group_doubles_result.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/7_Group_dubles_result.png)

Для просмотра содержимого массива дважды кликнике по нему.  
**Результат**: отобразится окно со списком полей, вложенных в массив.
![8_Group_doubles_params.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/8_Group_dubles_params.png)
При нажатии на поле отобразятся данные массива.
![9_Group_doubles_massive_data.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/9_Group_dubles_massive_data.png)
> **Ограничение**: размер документа — 16 Мб. Ограничение может быть превышено после группировки. 

Для корректного выполнения установите максимальное количество значений при заполнении параметров.  

![10_Group_doubles_max_size.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/10_Group_dubles_max_size.png)
Чтобы развернуть массив на верхний уровень, используйте агрегацию **"Развернуть массив"**.

## Удалить дубли

1. Выберите операцию **"Удалить дубли"** из списка.
2. В открывшемся окне:
<ul>
<li>Установите переключатель <b>"поля"</b>.</li>
<li>Выберите поля и нажмите <b>"Сохранить"</b>.</li>
</ul>

![11_Del_doubles.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/11_Del_dubles.png)
**Результат**: будет создана производная версия с уникальными значениями полей.

## Развернуть массив

Разворачивает массив данных на верхний уровень.  
Для выполнения операции используйте коллекцию с вложенным массивом данных (в таблице отображается в виде квадратных и фигурных скобок **"[количество значений{}]"**).

1. Выберите операцию **"Развернуть массив"** из списка.
2. В открывшемся окне:
<ul>
<li>Установите параметр <b>"поле"</b> по заголовку поля, содержащего массив данных.</li>
<li>Введите произвольный префикс.</li>
</ul>
![Развернуть массив.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/12_Razvernut_massive.png)

<ul>
<li>Нажмите <b>"Сохранить"</b>.</li>
</ul>

**Результат**: подмассивы вынесены на верхний уровень с указанным префиксом.  

![Реузльтат применения агрегации "Развернуть массив".png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/13_Razvernut_massive_result.png)

## Развернуть в объект

1. Выберите операцию **«Развернуть в объект»** из списка.
2. В открывшемся окне:
<ul>
<li>Установите параметр <b>"поле"</b> по заголовку поля, содержащего массив данных.</li>
</ul>

![Агрегация "Развернуть в объект".png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/14_to_object_params.png)

<ul>
<li>Нажмите <b>"Сохранить"</b>.</li>
</ul>

**Результат**: поля массива разворачиваются в объект (объект отображается с фигурными скобками).

![Результат применения агрегации "Развернуть в объект".png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/15_Razvernut_to_obj_result.png)
> В результате данной функции доступно назначение параметров ко вложенным данным.

#### Назначение параметров ко вложенному объекту

Для преобразования данных во вложенном объекте:

1. Выберите операцию преобразования.
2. Откройте вложенную структуру, дважды щелкнув по ячейке.
3. Нажмите на **поле, содержащее вложенную структуру**.

> Поля со вложенными структурами отображаются контрастно.

<ol start="4">
<li>Дважды нажмите на объект для отображения данных.</li>
<li>Выставьте параметры условия.</li>
<li>Введите имя производного поля <b>"Сохранить"</b>.</li>
</ol>

![Применение операции преобразований ко вложенной структуре объекта данных.png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/16_Params_to_vlojennyu_struktura.png)
**Результат**: операция будет применена к данным внутри объекта.
## Посчитать минимум
_Вычисляет минимальное значение для группы значений._

1. Выберите операцию **"Посчитать минимум"**.
2. В открывшемся окне:
<ul>
   <li>Установите переключатель <b>"поля для группировки"</b>.</li>
   <li>Выберите поля.</li>
</ul>

![Выставление параметра "поля для группировки".png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/17_min_field_field_for_groups.png)

<ul>
   <li>Установите параметр <b>"минимум по полю"</b>.</li>
   <li>Выберите поля.</li>
</ul>
![Выставление параметра "Минимум по полю".png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/18_min_for_field.png)

<ol start="3">
<li>Нажмите <b>"Сохранить"</b>.</li>
</ol>

**Результат**: созданы уникальные группы значений с рассчитанным минимумом для каждой.
![Результат применения агрегации "Посчитать минимум".png](../../images/4_Nastroyka/4_2_Preobrasovanuya/4_2_2_Aggregate/19_min_field_result.png)